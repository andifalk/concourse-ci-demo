<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">


		<title>Concourse CI</title>
        <meta name="description" content="Concourse CI">
        <meta name="author" content="Andreas Falk">

        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

        <link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/novatec.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">

                <!-- Introduction -->
                <section>
                    <section data-background="images/title_it_tage2018.png" data-background-size="100%">
                    </section>   
                    <!--     
                    <section>
                        <h2>Concourse CI</h4>
                        <p><a href="https://github.com/andifalk/concourse-ci-demo">Presentation and Demos: https://github.com/andifalk/concourse-ci-demo</a></p>
                        <p><small>Andreas Falk</small></p>
                        <img src="images/concourse-black.png" class="plain" width="40%">
                    </section>
                    -->
                    <section data-background-color="white">
                        <img src="images/andreas_falk.jpg" class="plain" width="35%">
                        <h4>Andreas Falk</h4>
                        <small>
                            <p><strong>Novatec Consulting GmbH</strong></p>
                            </p>andreas.falk@novatec-gmbh.de / @andifalk (Twitter)<br>
                            <br><a href="https://www.novatec-gmbh.de">https://www.novatec-gmbh.de</a><br>
                            <img src="images/novatec_logo_big.png" class="plain" width="40%">
                        </small>
                    </section>
                </section>

                <!-- Concourse CI Principles and Architecture-->
                <section>
                    <section>
                        <h1>What is Concourse CI ?</h1>
                        <img src="images/concourse-black.png" class="plain" width="40%">
                    </section>
                    <section>
                        <h3>&ldquo;Concourse is an open-source continuous thing-doer&rdquo;</h2>
                        <p>&ldquo;Built on the simple mechanics of resources, tasks, and jobs, Concourse presents a general approach to automation that makes it great for CI/CD&rdquo;</p>    
                        <p><small><a href="https://concourse-ci.org">https://concourse-ci.org</a></small></p>
                    </section>
                    <section>
                        <h2>Concourse CI Features</h2>
                        <p>Native Visualized Pipelines</p>
                        <p>Clean Isolation By Using Containers</p>
                        <p>Administration Via Command Line</p>
                        <img src="images/concourse-sample-pipeline.gif" class="plain">
                        <br><small><a href="https://concoursetutorial.com/">(picture taken from Concourse Tutorial by Stark & Wayne)</a></small>
                    </section>
                    <section>
                        <h2>Concourse CI Concepts</h2>
                        <p>Configuration As Code</p>
                        <p>No Plugins</p>
                        <p>Simple Building Blocks for Pipelines</p>   
                        <img src="images/concourse_concepts.png" class="plain" width="30%">  
                    </section>
                    <section>
                        <h2>Pipeline</h2>
                        <img src="images/concourse_concepts.png" class="plain" width="75%">    
                    </section>
                    <section>
                        <h2>Resource</h2>
                        <p>Connect Concourse CI to the outside world</p>
                        <img src="images/concourse_resource.png" class="plain" width="100%">    
                    </section>
                    <section>
                        <h2>Resource Types</h2>
                        <h4>Provided</h4>
                        <p>Git: Pull/push from/to git repository</p>
                        <p>S3: Get and upload from/to AWS S3</p>
                        <p>CF: Deploy an application to Cloud Foundry</p>
                    </section>
                    <section>
                        <h2>Resource Types</h2>
                        <h4>Community</h4>
                        <p>Artifactory: Get/upload artifacts from/to Artifactory</p>
                        <p>Kubernetes: Apply kubectl actions</p>
                    </section>
                    <section>
                        <h2>Task</h2>
                        <p>Pure Function</p>
                        <img src="images/concourse_task.png" class="plain" width="100%">    
                    </section>
                    <section>
                        <h3>Hello World task</h3>
                        <p>task-helloworld.yml</p>
                        <pre><code class="yaml" data-trim>
                                ---
                                platform: linux

                                image_resource:
                                    type: docker-image
                                    source: {repository: alpine}

                                run:
                                    path: echo
                                    args: ["Hello, world!"]
                        </code></pre>
                    </section>
                    <section>
                        <h3>Hello World Pipeline</h3>
                        <p>pipeline-helloworld.yml</p>
                        <pre><code class="yaml" data-trim>
                                jobs:
                                - name: hello-world
                                  plan:
                                  - task: say-hello
                                    file: task-helloworld.yml
                        </code></pre>
                    </section>    
                    <section>
                        <h3>Hello World Pipeline (Inline)</h3>
                        <p>pipeline-helloworld-inlined.yml</p>
                        <pre><code class="yaml" data-trim>
                                jobs:
                                - name: hello-world
                                  plan:
                                  - task: say-hello
                                    config:
                                      platform: linux
                                      image_resource:
                                        type: docker-image
                                        source: {repository: alpine}
                                      run:
                                        path: echo
                                        args: ["Hello, world!"]
                        </code></pre>
                    </section>
                    <section>
                        <h3>Concourse Architecture</h3>
                        <img src="images/concourse_architecture.png" class="plain" width="100%">
                    </section>                    
                </section>

                <!-- Concourse Setup -->

                <section>
                    <section>
                        <h1>Setting up Concourse CI</h1>
                        <img src="images/setup.png" class="plain" width="35%">
                    </section>
                    <section>
                        <h2>Possible Options</h2>
                        <ol>
                            <li><a href="https://github.com/concourse/concourse#quick-start">Run with docker-compose</a></li>
                            <li><a href="https://concourse-ci.org/install.html#quickstart">Use Concourse quickstart</a></li>
                            <li><a href="https://concourse-ci.org/install.html#cluster">Set up a multi-node cluster</a></li>
                            <li><a href="https://github.com/EngineerBetter/concourse-up">Concourse Up (EngineerBetter)</a></li>
                            <li><a href="https://github.com/kubernetes/charts/tree/master/stable/concourse">Concourse Helm Chart (k8s)</a></li>
                            <li><a href="https://github.com/starkandwayne/bucc">BUCC (StarkAndWayne)</a></li>
                        </ol>
                    </section>
                    <section>
                        <h3>Run with docker-compose</h3>
                        <pre><code class="shell" data-trim>
                            $ wget https://concourse-ci.org/docker-compose.yml
                            $ docker-compose up
                        </code></pre>
                    </section>                    
                    <section>
                        <h3>Use Concourse quickstart</h3>
                        <p>Required: Installed PostgreSQL database</p>
                        <pre><code class="shell" data-trim>
                            $ concourse quickstart \
                              --add-local-user dev:dev \
                              --main-team-local-user dev \
                              --postgres-user concourse --postgres-password concourse \
                              --worker-work-dir /home/afa/concourse/worker \
                              --external-url http://192.168.178.27:8080 \
                              --worker-garden-dns-server 1.1.1.1
                        </code></pre>
                    </section>                    
                    <section>
                        <h3>Install into Kubernetes cluster</h3>
                        <p>Prerequisite: <a href="https://docs.helm.sh/using_helm/#installing-helm">Install Helm</a></p>
                        <pre><code class="Bash" data-trim>
                            $ helm install stable/concourse 
                        </code></pre>
                        <p>After installing, perform this in same shell:</p>
                        <pre><code class="Bash" data-trim>
                            $ helm install stable/concourse 
                            $ export POD_NAME=$(kubectl get pods --namespace default \
                              -l "app=alternating-angelfish-web" \
                              -o jsonpath="{.items[0].metadata.name}")
                            $ echo "Visit http://127.0.0.1:8080 to use Concourse"
                            $ kubectl port-forward --namespace \ 
                              default $POD_NAME 8080:8080
                        </code></pre>
                    </section>                    
                </section>

                <!-- Concourse CI Pipelines -->
                <section>
                    <section>
                        <h2>Concourse</h2>
                        <h4>Command Line 1 x 1</h4>
                        <p><small><a href="https://github.com/concourse/fly/releases">Concourse Fly CLI</a></small></p>
                        <img src="images/bash.png" class="plain" width="40%">
                    </section>
                    <section>
                        <h3>Getting Started</h3>
                        <p>Login to Concourse</p>
                        <pre><code class="shell" data-trim>
                            $ fly login -t local -c http://127.0.0.1:8080 \
                              -u user -p password 
                        </code></pre>
                        <p>Logout from one Concourse target</p>
                        <pre><code class="shell" data-trim>
                            $ fly logout -t local 
                        </code></pre>
                        <p>Logout from all Concourse targets</p>
                        <pre><code class="shell" data-trim>
                            $ fly logout --all 
                        </code></pre>
                    </section>
                    <section>
                        <h3>Execute Tasks</h3>
                        <p>Execute a single task</p>
                        <pre><code class="shell" data-trim>
                            $ fly execute -t local -c mytask.yml 
                        </code></pre>
                        <p>Show results of a build execution</p>
                        <pre><code class="shell" data-trim>
                            $ fly -t local builds
                        </code></pre>
                    </section>
                    <section>
                        <h3>Using Pipelines</h3>
                        <p>Create or update a pipeline</p>
                        <pre><code class="shell" data-trim>
                            $ fly set-pipeline -t local -p mypipeline \
                                -c mypipeline-config.yml 
                        </code></pre>
                        <p>Un-pause a pipeline</p>
                        <pre><code class="shell" data-trim>
                            $ fly unpause-pipeline -t local -p mypipeline 
                        </code></pre>
                        <p>Delete a pipeline</p>
                        <pre><code class="shell" data-trim>
                            $ fly destroy-pipeline -t local -p mypipeline 
                        </code></pre>
                    </section>
                    <section>
                            <h3>Start & Watch Jobs</h3>
                            <p>Start a job in a pipeline</p>
                            <pre><code class="shell" data-trim>
                                $ fly trigger-job -t local -j mypipeline/myjob 
                            </code></pre>
                            <p>Start a job in a pipeline and watch output</p>
                            <pre><code class="shell" data-trim>
                                $ fly trigger-job -t local -j mypipeline/myjob --watch
                            </code></pre>
                            <p>Stream a build's output</p>
                            <pre><code class="shell" data-trim>
                                $ fly watch -t local -j mypipeline/myjob 
                            </code></pre>
                        </section>
                </section>
                
                <!-- Concourse CI Security-->
                <section>
                    <section>
                        <h2>Concourse Security</h2>
                    </section>
                    <section>
                        <h2>Authentication Providers</h2>
                        <p>Local users</p>
                        <p>3rd party providers (GitHub, CF UAA)</p>
                    </section>
                    <section>
                        <h2>Authorization By Teams</h2>
                        <p>&ldquo;main&rdquo; team (Administration)</p>
                        <p>Further teams created/updated by &ldquo;main&rdquo; team</p>
                    </section>
                    <section>
                        <h2>Credentials in Concourse CI</h2>
                        <p><a>CredHub</a></p>
                        <p><a>Hashicorp Vault</a></p>    
                    </section>
                    <section>
                        <h2>Hashicorp Vault</h2>
                        <img src="images/vault-black.png" class="plain" width="60%">
                        <p>
                                &ldquo;A Security Swiss Army Knife&rdquo;
                            </p>
                            <p>Jeff Mitchell, Vault Lead, HashiCorp</p>
                        <a href="https://www.vaultproject.io/">https://www.vaultproject.io</a>
                    </section>
                    <section>
                        <h2>CredHub</h2>
                        <p>CredHub manages credentials like passwords, certificates, certificate authorities, ssh keys, rsa keys and arbitrary values</p>
                        <a href="https://github.com/cloudfoundry-incubator/credhub">https://github.com/cloudfoundry-incubator/credhub</a>
                    </section>
                    <section>
                        <h3>Concourse quickstart</h3>
                        <h3>with Vault</h3>
                        <p>Required: Installed Vault instance</p>
                        <pre><code class="shell" data-trim>
                            $ concourse quickstart \
                                --add-local-user dev:dev \
                                --main-team-local-user dev \
                                --postgres-user concourse --postgres-password concourse \
                                --worker-work-dir /home/afa/concourse/worker \
                                --external-url http://192.168.178.27:8080 \
                                --worker-garden-dns-server 1.1.1.1 \
                                --vault-url http://10.2.0.3:8200 \
                                --vault-auth-backend approle \
                                --vault-auth-param role_id=db02de05-fa39-4855-059b-... \
                                --vault-auth-param secret_id=6a174c20-f6de-a53c-74d2-...
                        </code></pre>
                    </section>  
                    <section>
                        <h2>Credential lookup in Vault</h2>
                        <p>The parameter <em>((my_password))</em> is looked up in Vault namespaces in this order:</p>
                        <ol>    
                            <li>/concourse/{TEAM}/{PIPELINE}/my_password</li>
                            <li>/concourse/{TEAM}/my_password</li>
                        </ol>
                        <pre><code class="yaml" data-trim>
                            plan:
                            - get: my-repo
                            - task: integration
                              file: my-repo/ci/integration.yml
                              params:
                                REMOTE_SERVER: 10.20.30.40:8080
                                USERNAME: ((my-username))
                                PASSWORD: ((my-password))
                        </code></pre>
                    </section>
                </section>

                <!-- Conclusion -->

                <section>
                    <section>
                        <h1>Q&A</h1>
                        <p>https://www.novatec-gmbh.de<br>
                        https://blog.novatec-gmbh.de</p>
                        <p>andreas.falk@novatec-gmbh.de</p>
                        <p>@andifalk</p>
                        <img src="images/it_tage_2018.png" class="plain" width="20%">
                        <br><small>IT-Tage 2018 (Frankfurt)<br>12.12.2018<br><a href="https://www.ittage.informatik-aktuell.de/programm/2018/continuous-delivery-pipelines-mit-concourse-ci/">Continuous Delivery-Pipelines mit Concourse CI</a></small></br>
                    </section>
                    <section>
                        <h2>References</h2>
                        <small>
                            <ul>
                                <li><a href="https://concourse-ci.org">Concourse CI (https://concourse-ci.org)</a></li>
                                <li><a href="https://github.com/concourse/fly/releases">Concourse Fly CLI (https://github.com/concourse/fly/releases)</a></li>
                                <li><a href="https://github.com/cloudfoundry-incubator/credhub">CredHub (https://github.com/cloudfoundry-incubator/credhub)</a></li>
                                <li><a href="https://www.vaultproject.io">Vault (https://www.vaultproject.io)</a></li>
                                <li><a href="https://github.com/andifalk/concourse-ci-demo">Sources and Presentation (https://github.com/andifalk/concourse-ci-demo)</a></li>
                            </ul>
                            <p>All images used are from <a href="https://pixabay.com/">Pixabay</a> <br> and published under <a href="http://creativecommons.org/publicdomain/zero/1.0/deed.en">Creative Commons CC0 license.</a></p>
                            All used logos are trademarks of corresponding companies
                        </small>
                    </section>
                </section>

			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>


		<script>
			Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,
                pdfMaxPagesPerSlide: 1,
                allottedTime: 45 * 60 * 1000, // 45 minutes
                parallaxBackgroundImage: 'images/background_normal.jpg',
                parallaxBackgroundSize: '76%',
                parallaxBackgroundHorizontal: 0,
                parallaxBackgroundVertical: 0,

                transition: 'slide', // none/fade/slide/convex/concave/zoom
				dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
                    { src: 'plugin/print-pdf/print-pdf.js' },
                    { src: 'plugin/zoom-js/zoom.js', async: true },
                    { src: 'plugin/notes/notes.js', async: true },
                    { src: 'plugin/tagcloud/tagcloud.js', async: true },
                    { src: 'plugin/elapsed-time-bar/elapsed-time-bar.js'},
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() {
					    hljs.initHighlightingOnLoad(); }
					}
				]
			});
            Reveal.configure({ slideNumber: 'c/t' });
		</script>
	</body>
</html>
